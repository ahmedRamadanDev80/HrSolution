<div class="container mt-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Employee List</h2>
        <button *ngIf="hasRole('Admin')" class="btn btn-success" [routerLink]="['/employees/create']">
            <i class="bi bi-plus-lg"></i> Create New Employee
        </button>
    </div>

    <!-- Filters -->
    <form class="row g-2 align-items-center mb-3" (ngSubmit)="loadEmployees()">
        <!-- General search -->
        <div class="col-md-4">
            <input type="text" class="form-control" placeholder="Search..." [(ngModel)]="search" name="search" />
        </div>

        <div class="col-auto">
            <button type="submit" class="btn btn-primary">
                <i class="bi bi-search"></i> Search
            </button>
        </div>

        <div class="col-auto">
            <button type="button" class="btn btn-outline-success" (click)="exportEmployees()">
                <i class="bi bi-download"></i> Export
            </button>
        </div>

        <!-- Toggle Advanced Filters -->
        <div class="col-auto">
            <button type="button" class="btn btn-outline-secondary" (click)="toggleFilters()">
                <i class="bi bi-funnel"></i> Filters
            </button>
        </div>
    </form>

    <!-- Advanced Filters -->
    <div *ngIf="showFilters()" class="mt-3 p-3 border rounded bg-light">
        <div class="row g-3">

            <!-- Department Dropdown -->
            <div class="col-md-3">
                <label class="form-label">Department</label>
                <select class="form-select" [(ngModel)]="departmentId" name="departmentId">
                    <option [ngValue]="null">All</option>
                    <option *ngFor="let d of departments()" [ngValue]="d.id">
                        {{ d.name }}
                    </option>
                </select>
            </div>

            <!-- Job Title Dropdown -->
            <div class="col-md-3">
                <label class="form-label">Job Title</label>
                <select class="form-select" [(ngModel)]="jobTitleId" name="jobTitleId">
                    <option [ngValue]="null">All</option>
                    <option *ngFor="let j of jobTitles()" [ngValue]="j.id">
                        {{ j.name }}
                    </option>
                </select>
            </div>

            <!-- Date Filters -->
            <div class="col-md-3">
                <label class="form-label">DOB From</label>
                <input type="date" class="form-control" [(ngModel)]="DobFrom" name="dateFrom" />
            </div>

            <div class="col-md-3">
                <label class="form-label">DOB To</label>
                <input type="date" class="form-control" [(ngModel)]="DobTo" name="dateTo" />
            </div>

        </div>
    </div>


    <!-- Employee Table -->
    <div class="table-responsive mt-3">
        <table class="table table-striped table-bordered align-middle">
            <thead class="table-dark">
                <tr>
                    <th>Full Name</th>
                    <th>Email</th>
                    <th>Mobile</th>
                    <th>Department</th>
                    <th>Job Title</th>
                    <th class="text-center">Actions</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let e of employees()">
                    <td>{{ e.fullName }}</td>
                    <td>{{ e.email }}</td>
                    <td>{{ e.mobile }}</td>
                    <td>{{ e.departmentName }}</td>
                    <td>{{ e.jobTitleName }}</td>
                    <td class="text-center">
                        <button class="btn btn-sm btn-outline-primary me-1" [routerLink]="['/employees/edit', e.id]">
                            <i class="bi bi-pencil"></i> Edit
                        </button>
                        <button class="btn btn-sm btn-outline-danger" (click)="deleteEmployee(e.id)">
                            <i class="bi bi-trash"></i> Delete
                        </button>
                    </td>
                </tr>
                <tr *ngIf="employees().length === 0">
                    <td colspan="6" class="text-center">No employees found.</td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    <div class="d-flex justify-content-between align-items-center mt-3 flex-wrap gap-2">

        <!-- Page Buttons -->
        <div class="d-flex gap-1">
            <button class="btn btn-outline-primary" [disabled]="page() === 1" (click)="pageChanged(page() - 1)">
                Prev
            </button>

            <button class="btn btn-outline-primary" *ngFor="let p of pages()" [class.active]="p === page()"
                (click)="pageChanged(p)">
                {{ p }}
            </button>

            <button class="btn btn-outline-primary" [disabled]="page() === totalPages()"
                (click)="pageChanged(page() + 1)">
                Next
            </button>
        </div>

        <!-- Page Size Dropdown -->
        <div class="d-flex align-items-center gap-2">
            <label>Page Size:</label>
            <select class="form-select" style="width: 100px;" [value]="pageSize()"
                (change)="pageSizeChanged($any($event.target).value)">
                <option *ngFor="let size of pageSizes" [value]="size">{{ size }}</option>
            </select>
        </div>

        <!-- Total Items -->
        <div>Total: {{ total() }}</div>
    </div>
</div>